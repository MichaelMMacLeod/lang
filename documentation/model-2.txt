I still need to describe the program result, unique reduction, etc.

Clarifications:

  1. An underscore, '_', is used to specify that an object which is
     not important in the current context is not given a name. If two
     underscores are used in the same context they do not necessarily
     refer to the same object.

Model:

Definition [primitive-values-implementation]: A pair (SPV,=), where
SPV is a set and = is an equivalence relation on SPV.

Definition [primitive-values]: The set 'SPV' in the
[primitive-values-implementation].

Definition [=]: The equivalence relation '=' in the
[primitive-values-implementation].

Definition [identical-primitive-values]: Two [primitive-values] PV1
and PV2 are identical if and only if PV1 [=] PV2.

Definition [term-graph]: A directed graph (V,E) where V is the set of
vertices and E is the set of edges is a term graph if and only if all
of the following conditions apply:

  1. (V,E) either (consists of exactly one connected component) or (V
     and E are both empty sets).

  2. For every vertex VX, if VX is not a leaf then VX has no
     label. Otherwise, if VX is a leaf, VX is labeled with a member of
     the [primitive-values].

  3. For every vertex VX in V, if VX has N outgoing edges, then each
     of its edges has a non-negative integer label less than N and
     unique with respect to the other outgoing edges of VX.

Definition [identical-term-graphs]: Two [term-graph]s, G1 and G2, are
identical if and only if all of the following conditions apply:

  1. G1 and G2 are isomorphic.

  2. For every going edge E1 of vertex V1 with label E1L of G1 and for
     every outgoing edge E2 of vertex V2 with label E2L of G2, if both
     (V1 and V2) and (E1 and E2) are in the same position (in the
     sense of the isomorphism) on their respective graphs, E1L = E2L.

  3. For every leaf vertex G1V with label G1L of G1 and every leaf
     vertex G2V with label G2L of G2, if G1V and G2V are in the same
     position (in the sense of the isomorphism) on their respective
     graphs, then G1L [=] G2L.

Definition [unit-graph]: The graph ({},{}).

Theorem [unit-term-graph]: [unit-graph] is a [term-graph].

Proof [unit-term-graph]: [term-graph][1] holds. [term-graph][2] and
[term-graph][3] are vacuously true because [unit-graph] has no
vertices.

Definition [scope-set]: A finite set of non-negative integers. See
citation [binding-as-sets-of-scopes] for why this is a useful
definition.

Definition [term]: A pair (TG,TS) where TG is a [term-graph] and TS is
a [scope-set].

Definition [rule]: A pair (P,Q,PQS) where both P and Q are
[term-graph]s and PQS is a [scope-set].

Definition [deterministic-rules]: A pair of rules
((P1,Q1,PQS1),(P2,Q2,PQS2)) where exactly one of the following
conditions hold:

  1. PQS1 != PQS2

  2. (P1 and P2 are [identical-term-graphs]) implies (Q1 and Q2 are
     [identical-term-graphs])

Definition [environment]: A set of objects E is an environment if and
only if all of the following conditions hold:

  1. The members of E are pairwise [deterministic-rules].

  2. E contains the [rule] (U,U,{}), where U is the [nit-term-graph].

Definition [applicable-rules]: For a given [term] (TG,TS) and
[environment] E, a set of objects A is a set of applicable rules if
and only if all of the following conditions apply:

  1. Every member of A is a member of E.

  2. If (AG,_,_) is a member of A, then TG and AG are
     [identical-term-graphs].

  3. If (_,_,PQS) is a member of A, then PQS is a non-strict subset of
     TS.

Definition [best-rule]: For a given set of [applicable-rules] A, if
there exists an object B such that all of the following conditions
apply, then B is a best rule:

  1. B is a member of A. Let us also call B (_,_,PQS).

  2. For all members (_,_,PQSM) of A, PQSM is a non-strict subset of
     PQS.

Definition [identical-rules]: For any [rule]s R1=(P1,Q1,PQS1) and
R2=(P2,Q2,PQS2), R1 and R2 are identical rules if and only if all of
the following conditions hold.

  1. P1 and P2 are [identical-term-graphs].

  2. Q1 and Q2 are [identical-term-graphs].

  3. PQS1 = PQS2.

Theorem [unique-best-rule]: For a given set of [applicable-rules] A,
if A is nonempty then there exists a [best-rule] R in A such that for
all [best-rule]s RI in A, R and RI are [identical-rules].

Proof [unique-best-rule]:

  1. Let A be a nonempty set of [applicable-rules].

  2. Suppose there exist two [rule]s of A, R=(P1,Q1,PQS1) and
     RI=(P2,Q2,PQS2), such that both R and RI are [best-rule]s.

  3. Because A is a set of [applicable-rules], for all [rule]s
     (XG,_,_) and (YG,_,_) in A, XG and YG are
     [identical-term-graphs]. Because R and RI are members of A, P1
     and P2 must be [identical-term-graphs].

  4. Because A is a set of [applicable-rules], there exists an
     [environment] E such that every member of A is a member of E.

  5. Because of (4), members of A are pairwise
     [deterministic-rules]. Because R and RI are members of A, R and
     RI are [determinstic-rules].

  6. Because of (5), either PQS1 != PQS2, or (P1 and P2 are
     [identical-term-graphs]) implies (Q1 and Q2 are
     [identical-term-graphs])

  7. Because of (2), PQS1 is a non-strict subset of PQS2, and PQS2 is
     a non-strict subset of PQS1. In other words, PQS1 = PQS2.

  8. Because of (6) and (7), we know that (P1 and P2 are
     [identical-term-graphs]) implies (Q1 and Q2 are
     [identical-term-graphs]) is true. Moreover, we know from (3) that
     P1 and P2 are [identical-term-graphs], so it must be the case
     that Q1 and Q2 are [identical-term-graphs].

  9. Because of (3), (8), and (7), the following conditions hold:

       a. P1 and P2 are [identical-term-graphs], ; from (3)

       b. Q1 and Q2 are [identical-term-graphs], ; from (8)

       c. and PQS1 = PQS2.                       ; from (7)

     So R and RI are [identical-rules], thus [unique-best-rule] is
     true, and we are done with the proof.

Citations:

  - [binding-as-sets-of-scopes]: "Binding as Sets of Scopes: Notes on
    a new model of macro expansion for Racket" by Matthew Flatt
    (https://users.cs.utah.edu/plt/scope-sets/index.html). Archived
    version: (https://web.archive.org/web/20231005035007/https://users.cs.utah.edu/plt/scope-sets/index.html).
